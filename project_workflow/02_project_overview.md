# VRChat Log Relay Server - プロジェクト概要

## 📖 プロジェクトとは

**VRChat Log Relay Server** は、VRChatのログファイルをリアルタイムで監視し、WebSocketを通じて外部アプリケーションにログ情報を中継するサーバーシステムです。

## 🎯 解決する課題

### VRChatワールドの制約
- VRChatワールド内から外部への直接的なネットワーク通信は不可能
- **ログファイル** が唯一のデータ出力手段
- リアルタイムでのデータ取得が困難

### 現状の問題点
- 複数のアプリケーションが個別にログファイルを監視 → 非効率
- ログ解析ロジックの重複実装
- リアルタイム性の確保が困難
- VRChat起動状態の把握が不安定

## 💡 本プロジェクトのソリューション

### 中央集約型アーキテクチャ
```
VRChatワールド → ログファイル → 中継サーバー → 複数のクライアントアプリ
```

### 提供する価値
1. **統一されたAPI**: WebSocketプロトコルによる標準化
2. **リアルタイム配信**: ログ検出から100ms以内での配信
3. **複数クライアント対応**: 最大50の同時接続
4. **VRChat状態監視**: プロセス・ログディレクトリの監視
5. **フィルタリング機能**: クライアント毎の必要なデータのみ配信

## 🌟 主要機能

### 1. VRChatログ監視システム
- **プロセス監視**: VRChat.exe の起動/終了を検知
- **ディレクトリ監視**: ログディレクトリの作成/削除を検知
- **ファイル監視**: 複数ログファイルの同時監視 (vrc-tail準拠)
- **自動切り替え**: ファイルローテーション対応

### 2. 高度なメッセージ解析
- **構造化**: 生ログを構造化データに変換
- **Udon特化**: UdonBehaviourログの特別処理
- **イベント分類**: ワールド変更、ユーザー参加/離脱、カスタムイベント
- **フィルタリング**: ログレベル、ソース、内容による絞り込み

### 3. WebSocket配信プラットフォーム
- **リアルタイム配信**: 低遅延での即座な配信
- **接続管理**: クライアント接続状態の監視
- **メッセージ分配**: 効率的な並列配信
- **状態通知**: VRChat起動状態の変更を自動通知

### 4. 管理・監視機能
- **Web管理UI**: ブラウザベースの管理画面
- **メトリクス**: 接続数、メッセージ数、パフォーマンス統計
- **ヘルスチェック**: システム状態の監視
- **ログ管理**: サーバー自体のログ出力

## 🔧 技術アーキテクチャ

### システム構成
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   VRChat Log    │───▶│  Log Relay      │───▶│  Client Apps    │
│   Files         │    │  Server         │    │  (WebSocket)    │
│     ↓           │    │     ↓           │    │                 │
│  - Process      │    │  - Monitoring   │    │  - Unity Apps   │
│  - Directory    │    │  - Parsing      │    │  - Web Apps     │
│  - Files        │    │  - Distribution │    │  - Native Apps  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │  Admin Web UI   │
                       │  (Management)   │
                       └─────────────────┘
```

### 技術選択理由

#### Node.js + TypeScript
- **高パフォーマンス**: 非同期I/Oでファイル監視に最適
- **豊富なライブラリ**: WebSocket、ファイル監視の成熟したライブラリ
- **クロスプラットフォーム**: Windows環境での安定動作
- **型安全性**: TypeScriptによる開発効率と品質向上

#### WebSocket選択理由
- **リアルタイム**: HTTP比で圧倒的な低遅延
- **双方向通信**: ステータス取得、フィルター設定が可能
- **軽量**: ローカル通信でのオーバーヘッド最小化
- **標準技術**: あらゆるクライアントから接続可能

## 🎯 ユースケース

### 対象クライアントアプリケーション
1. **VRChatワールド連携アプリ**
   - プレイヤー参加/離脱の通知
   - Udonイベントの外部連携
   - ワールド状態の可視化

2. **配信支援ツール**
   - OBSオーバーレイ
   - ライブ配信情報表示
   - 視聴者インタラクション

3. **開発・デバッグツール**
   - Udonスクリプトのデバッグ
   - パフォーマンス監視
   - ログ解析ツール

4. **コミュニティツール**
   - Discord Bot連携
   - Webダッシュボード
   - 統計・分析ツール

### 実装パターン例

#### パターン1: シンプルなログ監視
```javascript
// VRChatワールドでのプレイヤー参加を検知
ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  if (message.type === 'log_message' && 
      message.data.parsed?.type === 'user_join') {
    console.log('プレイヤーが参加:', message.data.parsed.data.playerName);
  }
};
```

#### パターン2: Udonイベント連携
```javascript
// Udonスクリプトからのカスタムイベントを処理
ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  if (message.data.source === 'udon') {
    handleUdonEvent(message.data.parsed);
  }
};
```

#### パターン3: VRChat状態監視
```javascript
// VRChat起動状態を監視してUI更新
ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  if (message.type === 'vrchat_status_change') {
    updateVRChatStatusUI(message.data.currentStatus);
  }
};
```

## 🚀 期待される効果

### 開発者メリット
- **開発時間短縮**: ログ監視ロジックの実装不要
- **安定性向上**: 実績のあるライブラリによる高い信頼性
- **機能集中**: アプリ固有の機能開発に集中可能
- **保守性向上**: 中央集約による保守負荷軽減

### ユーザーメリット
- **応答性向上**: リアルタイムな状態更新
- **安定性**: 複数アプリでのリソース競合解消
- **拡張性**: 新しいアプリケーションの容易な追加
- **整合性**: 全アプリで同じデータソースを使用

### エコシステムメリット
- **標準化**: VRChat連携アプリの開発標準の確立
- **コミュニティ**: 共通基盤による開発コミュニティ形成
- **イノベーション**: 新しいアイデアの実現しやすさ

## 📋 プロジェクト制約

### ローカル環境専用設計
- **セキュリティ**: localhost (127.0.0.1) のみ対応
- **認証**: 認証機能なし（ローカル環境前提）
- **スケール**: 50クライアント接続まで
- **プラットフォーム**: Windows環境が主要対象

### VRChat依存
- **ログ形式**: VRChatのログフォーマットに依存
- **ファイル配置**: VRChatの標準ログディレクトリに依存
- **アップデート影響**: VRChatアップデートによる仕様変更リスク

## 🎖️ 成功の定義

### 技術的成功指標
- [ ] VRChatプロセス検知率: 99%以上
- [ ] ログ配信遅延: 100ms以内
- [ ] システム稼働率: 99.9%以上
- [ ] メモリ使用量: 128MB以内
- [ ] 同時接続50クライアント対応

### 利用促進指標
- [ ] サンプルクライアント実装: 3種類以上
- [ ] ドキュメント完成度: 実装サンプル付き
- [ ] エラーハンドリング: グレースフル対応
- [ ] 管理UI: 直感的な操作画面

---

このプロジェクトは、VRChatエコシステムにおけるデータ連携の基盤インフラとなることを目指しています。
